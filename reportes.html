<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Viaggio Usuarios</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN"
      crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL"
      crossorigin="anonymous"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"
      rel="stylesheet">
    <script src="common.js"></script>
    <script src="reportes.js"></script>
  </head>
  <body>
    <nav class="navbar navbar-expand-lg bg-body-tertiary">
      <div class="container-fluid">
        <a class="navbar-brand" href="#">
          <img src="viaggio.jpeg" alt="Logo" width="120" height="24" class="d-inline-block align-text-top">
        </a>
        <button
          class="navbar-toggler"
          type="button"
          data-bs-toggle="collapse"
          data-bs-target="#navbarNavAltMarkup"
          aria-controls="navbarNavAltMarkup"
          aria-expanded="false"
          aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNavAltMarkup">
          <div class="navbar-nav">
            <a class="nav-link" href="reservas.html">Reservas</a>
            <a class="nav-link" href="importaciones.html">Importaciones</a>
            <a class="nav-link" href="usuarios.html">Usuarios</a>
            <a class="nav-link" href="ventas.html">Ventas</a>
          </div>
        </div>
      </div>
    </nav>
    <div class="container">
      <div class="row">
        <div class="col col-sm-2 text-center">
          <button type="button" class="btn" id="retro">
            <i class="fa fa-chevron-left fa-2x"></i>
          </button>
        </div>
        <div class="col col-sm-8 text-center" id="titulo">
          <h1></h1>
        </div>
        <div class="col col-sm-2 text-center">
          <button type="button" class="btn" id="avanza">
            <i class="fa fa-chevron-right fa-2x"></i>
          </button>
        </div>
      </div>
      <div class="row">
        <div style="overflow-x: auto;white-space: nowrap;">
          <table class="table table-striped">
            <thead>
              <tr>
                <th scope="col" class="bg-secondary text-white"></th>
                <th scope="col" class="bg-secondary text-white" id="fecha-1">lun</th>
                <th scope="col" class="bg-secondary text-white" id="fecha-2">mar</th>
                <th scope="col" class="bg-secondary text-white" id="fecha-3">mie</th>
                <th scope="col" class="bg-secondary text-white" id="fecha-4">jue</th>
                <th scope="col" class="bg-secondary text-white" id="fecha-5">vie</th>
                <th scope="col" class="bg-secondary text-white" id="fecha-6">sab</th>
              </tr>
            </thead>
            <tbody>
              <tr id="hora-8">
                <td class="bg-secondary text-white">08:00</td>
                <td id="lun-8" class="text-white border"></td>
                <td id="mar-8" class="text-white border"></td>
                <td id="mie-8" class="text-white border"></td>
                <td id="jue-8" class="text-white border"></td>
                <td id="vie-8" class="text-white border"></td>
                <td id="sab-8" class="text-white border"></td>
              </tr>
              <tr id="hora-9">
                <td class="bg-secondary text-white">09:00</td>
                <td id="lun-9" class="text-white border"></td>
                <td id="mar-9" class="text-white border"></td>
                <td id="mie-9" class="text-white border"></td>
                <td id="jue-9" class="text-white border"></td>
                <td id="vie-9" class="text-white border"></td>
                <td id="sab-9" class="text-white border"></td>
              </tr>
              <tr id="hora-10">
                <td class="bg-secondary text-white">10:00</td>
                <td id="lun-10" class="text-white border"></td>
                <td id="mar-10" class="text-white border"></td>
                <td id="mie-10" class="text-white border"></td>
                <td id="jue-10" class="text-white border"></td>
                <td id="vie-10" class="text-white border"></td>
                <td id="sab-10" class="text-white border"></td>
              </tr>
              <tr id="hora-11">
                <td class="bg-secondary text-white">11:00</td>
                <td id="lun-11" class="text-white border"></td>
                <td id="mar-11" class="text-white border"></td>
                <td id="mie-11" class="text-white border"></td>
                <td id="jue-11" class="text-white border"></td>
                <td id="vie-11" class="text-white border"></td>
                <td id="sab-11" class="text-white border"></td>
              </tr>
              <tr id="hora-12">
                <td class="bg-secondary text-white">12:00</td>
                <td id="lun-12" class="text-white border"></td>
                <td id="mar-12" class="text-white border"></td>
                <td id="mie-12" class="text-white border"></td>
                <td id="jue-12" class="text-white border"></td>
                <td id="vie-12" class="text-white border"></td>
                <td id="sab-12" class="text-white border"></td>
              </tr>
              <tr id="hora-13">
                <td class="bg-secondary text-white">13:00</td>
                <td id="lun-13" class="text-white border"></td>
                <td id="mar-13" class="text-white border"></td>
                <td id="mie-13" class="text-white border"></td>
                <td id="jue-13" class="text-white border"></td>
                <td id="vie-13" class="text-white border"></td>
                <td id="sab-13" class="text-white border"></td>
              </tr>
              <tr id="hora-14">
                <td class="bg-secondary text-white">14:00</td>
                <td id="lun-14" class="text-white border"></td>
                <td id="mar-14" class="text-white border"></td>
                <td id="mie-14" class="text-white border"></td>
                <td id="jue-14" class="text-white border"></td>
                <td id="vie-14" class="text-white border"></td>
                <td id="sab-14" class="text-white border"></td>
              </tr>
              <tr id="hora-15">
                <td class="bg-secondary text-white">15:00</td>
                <td id="lun-15" class="text-white border"></td>
                <td id="mar-15" class="text-white border"></td>
                <td id="mie-15" class="text-white border"></td>
                <td id="jue-15" class="text-white border"></td>
                <td id="vie-15" class="text-white border"></td>
                <td id="sab-15" class="text-white border"></td>
              </tr>
              <tr id="hora-16">
                <td class="bg-secondary text-white">16:00</td>
                <td id="lun-16" class="text-white border"></td>
                <td id="mar-16" class="text-white border"></td>
                <td id="mie-16" class="text-white border"></td>
                <td id="jue-16" class="text-white border"></td>
                <td id="vie-16" class="text-white border"></td>
                <td id="sab-16" class="text-white border"></td>
              </tr>
              <tr id="hora-17">
                <td class="bg-secondary text-white">17:00</td>
                <td id="lun-17" class="text-white border"></td>
                <td id="mar-17" class="text-white border"></td>
                <td id="mie-17" class="text-white border"></td>
                <td id="jue-17" class="text-white border"></td>
                <td id="vie-17" class="text-white border"></td>
                <td id="sab-17" class="text-white border"></td>
              </tr>

            </tbody>
          </table>
        </div>
      </div>
    </div>
    <script>

let miUsuarioTipo = localStorage.getItem("miUsuarioTipo");

if(!miUsuarioTipo || miUsuarioTipo !== "admin"){
    window.location.href = "reservas.html";
}
let tipoConsulta = "semana";
let anho,mes,dia;

function setDiaInicio(){
    let hoy = new Date();
    anho = hoy.getFullYear();
    mes = hoy.getMonth()+1;
    dia = 1;
}

function pintarStat(datos){
    let vecDay = ["dom","lun","mar","mie","jue","vie","sab"];
    let max = 0;
    for(let d=1;d<7;d++){
        for(h=0;h<10;h++){
            let label = vecDay[d]+"-"+(8+h);
            let valor = datos[d][h];
            if(max < valor){
                max = valor;
            }
            let elem = document.getElementById(label);
            elem.innerHTML = valor;
            elem.classList.remove("bg-danger"); //rojo
            elem.classList.remove("bg-warning"); //amarillo
            elem.classList.remove("bg-success"); //verde
            elem.classList.add("bg-primary"); //gris
        }
    }
    if(max === 0){
        return;
    }
    
    
    for(let d=1;d<7;d++){
        for(h=0;h<10;h++){
            let label = vecDay[d]+"-"+(8+h);
            let elem = document.getElementById(label);
            let valor = datos[d][h]/max;
            if(valor>0.75){
                elem.classList.remove("bg-primary");
                elem.classList.add("bg-danger");
            } else if(valor>0.5){
                elem.classList.remove("bg-primary");
                elem.classList.add("bg-warning");
            } else if(valor>0.25){
                elem.classList.remove("bg-primary");
                elem.classList.add("bg-success");
            }
        }
    }
}

window.onload = function() {
    Datos.iniciar().then(() => {
        window.document.getElementById("titulo").click();
        return Datos.getStatMes(anho,mes);
    }).then(pintarStat);
};

let tipoEstadistica = "anho";
let paramEstadistica = 1;
window.document.getElementById("titulo").onclick = function(){
    setDiaInicio();
    switch(tipoEstadistica){
        case "mes":
            tipoEstadistica = "trimestre";
            paramEstadistica = Math.ceil(mes/3);
            window.document.getElementById("titulo").innerHTML = "<b>Trimestre: "+ paramEstadistica +" / "+ anho +"</b>";
            Datos.getStatTrim(anho,paramEstadistica).then(pintarStat);
            break;
        case "trimestre":
            tipoEstadistica = "semestre";
            paramEstadistica = Math.ceil(mes/6);
            window.document.getElementById("titulo").innerHTML = "<b>Semestre: "+paramEstadistica +" / "+ anho +"</b>";
            Datos.getStatSem(anho,paramEstadistica).then(pintarStat);
            break;
        case "semestre":
            tipoEstadistica = "anho";
            paramEstadistica = anho;
            window.document.getElementById("titulo").innerHTML = "<b>Año: "+ anho +"</b>";
            Datos.getStatAnho(anho).then(pintarStat);
            break;
        case "anho":
            tipoEstadistica = "mes";
            paramEstadistica = mes;
            window.document.getElementById("titulo").innerHTML = "<b>Mes: "+paramEstadistica +" / "+ anho +"</b>";
            Datos.getStatMes(anho,paramEstadistica).then(pintarStat);
            break;
    }
};
window.document.getElementById("avanza").onclick = function(){
    switch(tipoEstadistica){
        case "mes":
            paramEstadistica++;
            if(paramEstadistica>12){
                paramEstadistica = 1;
                anho++;
            }
            window.document.getElementById("titulo").innerHTML = "<b>Mes: "+paramEstadistica +" / "+ anho +"</b>";
            Datos.getStatMes(anho,paramEstadistica).then(pintarStat);
            break;
        case "trimestre":
            paramEstadistica++;
            if(paramEstadistica>4){
                paramEstadistica = 1;
                anho++;
            }
            window.document.getElementById("titulo").innerHTML = "<b>Trimestre: "+ paramEstadistica +" / "+ anho +"</b>";
            Datos.getStatTrim(anho,paramEstadistica).then(pintarStat);
            break;
        case "semestre":
            paramEstadistica++;
            if(paramEstadistica>2){
                paramEstadistica = 1;
                anho++;
            }
            window.document.getElementById("titulo").innerHTML = "<b>Semestre: "+paramEstadistica +" / "+ anho +"</b>";
            Datos.getStatSem(anho,paramEstadistica).then(pintarStat);
            break;
        case "anho":
            anho++;
            window.document.getElementById("titulo").innerHTML = "<b>Año: "+ anho +"</b>";
            Datos.getStatAnho(anho).then(pintarStat);
            break;
    }
};
window.document.getElementById("retro").onclick = function(){
    switch(tipoEstadistica){
        case "mes":
            paramEstadistica--;
            if(paramEstadistica<=0){
                paramEstadistica = 12;
                anho--;
            }
            window.document.getElementById("titulo").innerHTML = "<b>Mes: "+paramEstadistica +" / "+ anho +"</b>";
            Datos.getStatMes(anho,paramEstadistica).then(pintarStat);
            break;
        case "trimestre":
            paramEstadistica--;
            if(paramEstadistica<=0){
                paramEstadistica = 4;
                anho--;
            }
            window.document.getElementById("titulo").innerHTML = "<b>Trimestre: "+ paramEstadistica +" / "+ anho +"</b>";
            Datos.getStatTrim(anho,paramEstadistica).then(pintarStat);
            break;
        case "semestre":
            paramEstadistica--;
            if(paramEstadistica<=0){
                paramEstadistica = 2;
                anho--;
            }
            window.document.getElementById("titulo").innerHTML = "<b>Semestre: "+paramEstadistica +" / "+ anho +"</b>";
            Datos.getStatSem(anho,paramEstadistica).then(pintarStat);
            break;
        case "anho":
            anho--;
            window.document.getElementById("titulo").innerHTML = "<b>Año: "+ anho +"</b>";
            Datos.getStatAnho(anho).then(pintarStat);
            break;
    }
};

    </script>
  </body>
</html>
